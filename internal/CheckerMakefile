# Expect external environment variables:
# - CXX: real C++ compiler name, default to g++
# - CXXFLAGS: C++ compilation flags
# - INCPATHS: include paths (absolute path preferred)

# This can be override by environment variables
CXX ?= g++ 
CXXFLAGS := $(foreach dir, $(INCPATHS), -I $(dir)) $(CXXFLAGS)
SHELL := /bin/bash

# Find all C++ source files with different extensions
# TODO should we search for **/*.cpp ?
CPP_SOURCES = $(wildcard *.cpp) $(wildcard *.cc)

SRCS = $(CPP_SOURCES) $(CC_SOURCES)
DEP = checker.d
EXE = checker

all: $(EXE)

$(DEP): $(CPP_SOURCES)
	$(CXX) $(CXXFLAGS) -MM $^ -MT $(EXE) -MF $@

include $(DEP)

$(EXE): $(CPP_SOURCES)
	$(CXX) $(CXXFLAGS) -fdiagnostics-color=never $(CPP_SOURCES) -o $(EXE) 2> checker.compile.log

clean:
	rm -f $(EXE) $(DEP)

.PHONY: all clean
